{# templates/form/tw_theme.html.twig #}
{% use 'form_div_layout.html.twig' %}

{# =========================
ROW & ERRORS
========================= #}
{% block form_row -%}
{%- set row_class = (row_attr.class|default('') ~ ' sm:col-span-3')|trim -%}
{%- set row_attr = row_attr|merge({class: row_class}) -%}
<div {{ block('attributes') }}>
    {{- form_label(form) -}}
    <div class="mt-1">
        {{- form_widget(form) -}}
    </div>
    {{- form_errors(form) -}}
    {%- if help is not empty -%}
    <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">{{ help|raw }}</p>
    {%- endif -%}
</div>
{%- endblock %}

{% block form_errors -%}
{%- if errors|length > 0 -%}
<ul class="mt-2 space-y-1 text-sm text-rose-600 dark:text-rose-400">
    {%- for error in errors -%}
    <li>{{ error.message }}</li>
    {%- endfor -%}
</ul>
{%- endif -%}
{%- endblock %}

{# =========================
LABELS
========================= #}
{% block form_label -%}
{%- if label is not same as(false) -%}
{%- set label_attr = label_attr|merge({
class: (label_attr.class|default('') ~ ' block text-sm font-medium text-gray-900 dark:text-gray-100')|trim
}) -%}
{{- parent() -}}
{%- endif -%}
{%- endblock %}

{# =========================
TEXT / INPUTS
========================= #}
{% block form_widget_simple -%}
{% if type is defined and type == 'hidden' %}
{{ parent() }}
{% else %}
{% set attr = attr|merge({
class: (attr.class|default('') ~ ' block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline
outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2
focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6 dark:bg-white/5 dark:text-white dark:outline-white/10
dark:placeholder:text-gray-500 dark:focus:outline-indigo-500')|trim
}) %}
{{- parent() -}}
{% endif %}
{%- endblock %}

{% block textarea_widget -%}
{% set attr = attr|merge({
class: (attr.class|default('') ~ ' block w-full rounded-md bg-white px-3 py-2 text-base text-gray-900 outline outline-1
-outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2
focus:outline-indigo-600 sm:text-sm/6 dark:bg-white/5 dark:text-white dark:outline-white/10
dark:placeholder:text-gray-500 dark:focus:outline-indigo-500')|trim
}) %}
{{- parent() -}}
{%- endblock %}

{# =========================
CHOICES (SELECT)
========================= #}
{% block choice_widget_collapsed -%}
{# On stylise le <select> natif pour ressembler à ton bouton dropdown #}

    {% set select_classes = '
    block w-full appearance-none rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900
    shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:outline-none focus:ring-2
    focus:ring-indigo-600 dark:bg-white/10 dark:text-white dark:shadow-none dark:ring-white/5
    dark:hover:bg-white/20
    ' %}

    {# on fusionne avec d’éventuelles classes existantes #}
    {% set attr = attr|merge({ class: (attr.class|default('') ~ ' ' ~ select_classes)|trim }) %}

    <div class="relative w-full">
        <select {{ block('widget_attributes') }}{% if multiple %} multiple="multiple" {% endif %}
            class="{{ attr.class }}">
            {%- if placeholder is not null -%}
            <option value="" {%- if required and (value is empty) and (not placeholder_in_choices) and (not multiple)
                -%} selected="selected" {%- endif -%}>
                {{ placeholder is same as('') ? '' : (
                translation_domain is same as(false)
                ? placeholder
                : placeholder|trans({}, translation_domain)
                ) }}
            </option>
            {%- endif -%}

            {# IMPORTANT : transmettre "options" (et non "choices") #}
            {%- if preferred_choices|length > 0 -%}
            {% with { options: preferred_choices } %}
            {{ block('choice_widget_options') }}
            {% endwith %}
            {%- if choices|length > 0 and separator is not null -%}
            <option disabled="disabled">{{ separator }}</option>
            {%- endif -%}
            {%- endif -%}

            {% with { options: choices } %}
            {{ block('choice_widget_options') }}
            {% endwith %}
        </select>

        {# Chevron à droite, non cliquable #}
        <svg viewBox="0 0 20 20" aria-hidden="true"
            class="pointer-events-none absolute right-2 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 dark:text-gray-400">
            <path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"
                d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" />
        </svg>
    </div>
    {%- endblock %}

    {# On laisse le core générer les <option> #}
        {% block choice_widget_options %}
        {{ parent() }}
        {% endblock %}

        {# =========================
        CHECKBOX / RADIO
        ========================= #}
        {% block checkbox_widget -%}
        {%- set attr = attr|merge({
        class: (attr.class|default('') ~ ' h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-2
        focus:ring-indigo-600 dark:border-white/10 dark:bg-white/5 dark:text-indigo-500')|trim
        }) -%}
        {{- parent() -}}
        {%- endblock %}

        {% block radio_widget -%}
        {%- set attr = attr|merge({
        class: (attr.class|default('') ~ ' h-4 w-4 border-gray-300 text-indigo-600 focus:ring-2 focus:ring-indigo-600
        dark:border-white/10 dark:bg-white/5 dark:text-indigo-500')|trim
        }) -%}
        {{- parent() -}}
        {%- endblock %}

        {# =========================
        FILE
        ========================= #}
        {% block file_widget -%}
        {% set attr = attr|merge({
        class: (attr.class|default('') ~ ' block w-full text-sm text-gray-900 file:mr-4 file:rounded-md file:border-0
        file:bg-indigo-600 file:px-3 file:py-1.5 file:text-sm file:font-semibold file:text-white
        hover:file:bg-indigo-500 dark:text-gray-200 dark:file:bg-indigo-500 dark:hover:file:bg-indigo-400')|trim
        }) %}
        {{- parent() -}}
        {%- endblock %}

        {# =========================
        BUTTONS
        ========================= #}
        {% block button_widget -%}
        {% set attr = attr|merge({
        class: (attr.class|default('') ~ ' inline-flex items-center rounded-md bg-indigo-600 px-3 py-2 text-sm
        font-semibold text-white shadow-xs hover:bg-indigo-500 focus-visible:outline-2 focus-visible:outline-offset-2
        focus-visible:outline-indigo-600 dark:bg-indigo-500 dark:hover:bg-indigo-400')|trim
        }) %}
        {{- parent() -}}
        {%- endblock %}

        {% block submit_widget %}{{ block('button_widget') }}{% endblock %}
        {% block reset_widget %}{{ block('button_widget') }}{% endblock %}